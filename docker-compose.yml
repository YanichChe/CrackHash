version: '3.8'

services:
  consul:
    image: consul:1.15
    container_name: consul
    restart: unless-stopped
    ports:
      - "8500:8500"
      - "8600:8600/udp"
    command: [ "agent", "-server", "-bootstrap-expect=1", "-ui", "-client=0.0.0.0" ]
    networks:
      - crack-hash-net

  add_to_consul:
    image: curlimages/curl:8.12.1
    container_name: setup_consul
    depends_on:
      - consul
      - setup
    entrypoint: [ "bash", "add_to_consul.sh" ]
    volumes:
      - ./scripts/add_to_consul.sh:/add_to_consul.sh
    networks:
      - crack-hash-net

volumes:
  mongo1_data:
  mongo2_data:
  mongo3_data:
  mongo-keyfile:
  mongo1-config:
  mongo2-config:
  mongo3-config:
  mongo1-logs:
  mongo2-logs:
  mongo3-logs:

  rabbitmq1-data:
  rabbitmq2-data:
  rabbitmq3-data:
  rabbitmq1-logs:
  rabbitmq2-logs:
  rabbitmq3-logs:

networks:
  crack-hash-net: